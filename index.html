<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interaktive Story Engine mit KI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
</head>
<body class="bg-gray-100 min-h-screen p-4">
  <div id="root"></div>

  <script type="text/javascript">
    const { useState, useEffect } = React;

    function App() {
      const [story, setStory] = useState(() => {
        const saved = localStorage.getItem("storyData");
        return saved ? JSON.parse(saved) : {
          start: "intro",
          scenes: {
            intro: { text: "Willkommen! Erstelle oder spiele deine Story.", choices: [] }
          }
        };
      });

      const [currentScene, setCurrentScene] = useState(story.start);
      const [tab, setTab] = useState("play");
      const [newSceneId, setNewSceneId] = useState("");
      const [prompt, setPrompt] = useState("");
      const [generating, setGenerating] = useState(false);

      useEffect(() => {
        localStorage.setItem("storyData", JSON.stringify(story));
      }, [story]);

      const scene = story.scenes[currentScene] || { text: "Unbekannte Szene", choices: [] };

      // ... (restliche Funktionen wie addScene, deleteScene, updateScene, addChoice, etc. aus dem vorherigen Code bleiben gleich)

      async function generateStory() {
        if (!prompt) {
          alert("Bitte gib einen Kundenwunsch ein.");
          return;
        }
        setGenerating(true);
        try {
          // Placeholder für xAI Grok API-Aufruf
          // Ersetze mit echtem API-Key und Endpoint (siehe https://x.ai/api)
          const response = await fetch('https://api.x.ai/v1/chat/completions', {  // Beispiel-Endpoint (kompatibel mit OpenAI)
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': 'Bearer DEIN_API_KEY_HIER'  // Hole von https://console.x.ai/
            },
            body: JSON.stringify({
              model: 'grok-4',  // Oder grok-3-mini für günstiger
              messages: [{ role: 'user', content: `Generiere eine interaktive Geschichte als JSON: {start: "intro", scenes: {intro: {text: "...", choices: [{text: "...", next: "..."}]}}} basierend auf: ${prompt}` }]
            })
          });
          const data = await response.json();
          const generatedStory = JSON.parse(data.choices[0].message.content);  // Angenommen, API gibt JSON zurück
          setStory(generatedStory);
          setCurrentScene(generatedStory.start);
          alert("Story generiert!");
        } catch (error) {
          console.error(error);
          // Mock-Fallback für Tests
          const mockStory = {
            start: "intro",
            scenes: {
              intro: { text: `Generierte Story basierend auf: ${prompt}`, choices: [{ text: "Weiter", next: "ende" }] },
              ende: { text: "Ende der Geschichte.", choices: [] }
            }
          };
          setStory(mockStory);
          setCurrentScene(mockStory.start);
          alert("Mock-Story generiert (API-Fehler).");
        }
        setGenerating(false);
      }

      return (
        React.createElement("div", { className: "max-w-3xl mx-auto bg-white p-4 rounded shadow" },
          // Tabs erweitert um "KI-Generieren"
          React.createElement("div", { className: "flex mb-4 gap-2" },
            ["play", "edit", "generate"].map(t =>
              React.createElement("button", {
                key: t,
                onClick: () => setTab(t),
                className: `px-4 py-2 rounded ${tab === t ? "bg-blue-500 text-white" : "bg-gray-200"}`
              }, t === "play" ? "Spielen" : t === "edit" ? "Editor" : "KI-Generieren")
            ),
            // ... (Import/Export bleiben gleich)
          ),

          // Play und Edit Tabs bleiben gleich

          // Neuer Generate Tab
          tab === "generate" &&
            React.createElement("div", null,
              React.createElement("h2", { className: "font-bold mb-2" }, "Generiere Story basierend auf Kundenwunsch"),
              React.createElement("textarea", {
                value: prompt,
                onChange: e => setPrompt(e.target.value),
                placeholder: "z.B. 'Eine Fantasy-Geschichte mit einem Drachen und einem mutigen Helden'",
                className: "border w-full p-2 mb-2 h-24"
              }),
              React.createElement("button", {
                onClick: generateStory,
                disabled: generating,
                className: "bg-purple-500 text-white px-4 py-2 rounded"
              }, generating ? "Generiere..." : "Story generieren")
            )
        )
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(App));
  </script>
</body>
</html>
